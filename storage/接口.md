

nil-externalizing (nilext) interface
- 没有立刻返回结果的接口，使得做优化（重排序）成为可能
	- 一定是update接口
- Achieving Wire-Latency Storage Systems by Exploiting Hardware ACKs

Ordering Interface
- **`osync()` / `fbarrier()`**：这不同于 `fsync`。它可能不要求数据立刻写到磁盘（Durability），但它要求维持写入的**顺序**（Ordering）。

参考文章：
- Optimistic Crash Consistency
- Barrier-Enabled IO Stack for Flash Storage
核心都是维护高效的排序


其他接口
- Commutative Interface 可交换接口 操作顺序不重要
- Idempotent Interfaces 幂等接口

|**层面 (Dimension)**|**接口类型 (Interface Type)**|**核心定义/特征 (Semantics)**|**核心优势与劣势 (Pros & Cons)**|**典型案例 (Examples)**|
|---|---|---|---|---|
|**1. 故障恢复**<br><br>  <br><br>_(Reliability)_|**幂等接口**<br><br>  <br><br>(Idempotent)|$f(f(x)) = f(x)$<br><br>  <br><br>多次执行效果等同于一次。|✅ **优：** 允许无限重试，简化客户端错误处理。<br><br>  <br><br>❌ **劣：** 设计难度稍大，有时需携带额外状态。|`pwrite` (指定偏移写)<br><br>  <br><br>REST `PUT`/`DELETE`<br><br>  <br><br>TCP `ACK`|
||**非幂等接口**<br><br>  <br><br>(Non-Idempotent)|$f(f(x)) \neq f(x)$<br><br>  <br><br>副作用会累积。|✅ **优：** 语义直观，符合人类直觉。<br><br>  <br><br>❌ **劣：** 丢包时重试会导致数据错误，需去重机制。|`write` (追加写)<br><br>  <br><br>消息队列 `publish`<br><br>  <br><br>银行 `transfer`|
|**2. 并发扩展性**<br><br>  <br><br>_(Scalability)_|**可交换接口**<br><br>  <br><br>(Commutative)|$A \circ B = B \circ A$<br><br>  <br><br>执行顺序不影响最终状态。|✅ **优：** **极高并发**，无需全局锁，核心数越多越快。<br><br>  <br><br>❌ **劣：** 编程模型复杂，不支持依赖顺序的逻辑。|`create` (不同目录)<br><br>  <br><br>CRDTs (计数器加法)<br><br>  <br><br>`malloc` (各自的 Arena)|
||**顺序敏感接口**<br><br>  <br><br>(Ordered)|$A \circ B \neq B \circ A$<br><br>  <br><br>必须严格串行化。|✅ **优：** 逻辑简单，强一致性。<br><br>  <br><br>❌ **劣：** **扩展性瓶颈**，争抢锁导致性能剧降。|`write` (同一文件追加)<br><br>  <br><br>FIFO 队列消费<br><br>  <br><br>数据库串行化事务|
|**3. 状态管理**<br><br>  <br><br>_(Architecture)_|**无状态接口**<br><br>  <br><br>(Stateless)|请求包含所有必要上下文。<br><br>  <br><br>Server 不记 Client 状态。|✅ **优：** 服务器崩溃重启**零成本**，易于水平扩展。<br><br>  <br><br>❌ **劣：** 单次请求报文大，难以利用上下文优化。|**NFS v3**<br><br>  <br><br>HTTP/1.1<br><br>  <br><br>UDP|
||**有状态接口**<br><br>  <br><br>(Stateful)|Server 维护 Session/Handle。<br><br>  <br><br>请求依赖上下文。|✅ **优：** 通信高效，支持更复杂的锁/缓存协议。<br><br>  <br><br>❌ **劣：** 服务器崩溃后需复杂的**状态重建/恢复**协议。|**NFS v4**<br><br>  <br><br>TCP 连接<br><br>  <br><br>POSIX 文件描述符|
|**4. 一致性与原子性**<br><br>  <br><br>_(Consistency)_|**原子接口**<br><br>  <br><br>(Atomic)|All-or-Nothing。<br><br>  <br><br>要么全成功，要么全回滚。|✅ **优：** 保证数据不损坏，Crash Consistency 基础。<br><br>  <br><br>❌ **劣：** 实现昂贵（通常需日志或 Copy-on-Write）。|`rename`<br><br>  <br><br>`link`<br><br>  <br><br>DB `commit`|
||**条件接口**<br><br>  <br><br>(Conditional)|`if (state == X) do Y`<br><br>  <br><br>基于状态的原子更新。|✅ **优：** 实现无锁编程（Lock-free）和并发控制的基石。<br><br>  <br><br>❌ **劣：** 在高竞争下可能导致活锁（Livelock）。|`CAS` (Compare-And-Swap)<br><br>  <br><br>Etcd `Txn`<br><br>  <br><br>文件锁 `flock`|
|**5. 同步语义**<br><br>  <br><br>_(Latency)_|**同步接口**<br><br>  <br><br>(Synchronous)|调用直到操作完成才返回。<br><br>  <br><br>(Wait until durable).|✅ **优：** 编程简单，数据安全性高。<br><br>  <br><br>❌ **劣：** 延迟高，阻塞线程。|`fsync`<br><br>  <br><br>阻塞式 Socket `read`|
||**异步接口**<br><br>  <br><br>(Asynchronous)|提交请求即返回，通过 Callback 或 Poll 获取结果。|✅ **优：** 吞吐量极高，隐藏 I/O 延迟。<br><br>  <br><br>❌ **劣：** 编程复杂度极高（Callback Hell），需管理生命周期。|`io_uring`<br><br>  <br><br>Node.js I/O<br><br>  <br><br>RDMA verbs|